#summary How to compile your own fabfi image
<wiki:toc max_depth="4" />

= Introduction = 

Instead of using the images we provide on the site, you can build your own images either from source or from our customized OpenWRT imagebuilder. This page outlines both methods.  

= Workflow Overview =

When we build images, we follow these steps:

  # Checkout the svn trunk of the fabfi source (or a branch if you're not building latest)
  # download latest openwrt source trunk
  # run one of the fabfi build scripts from {fabfisrc}/trunk/scripts/ to create a fabfi image (there are a few methods explained below)

= Step-by-Step =

== Method 1: Automated from-scratch build ==

This script may be buggy / troubleshooting may be difficult, but if it works it's the simplest method.

# Prepare your computer - http://wiki.openwrt.org/doc/howto/buildroot.exigence
#Checkout latest fabfi trunk
{{{
	svn checkout https://fabfi.googlecode.com/svn/trunk/ fabfi 
}}}
#Navigate to 
{{{
cd fabfi/scripts
}}}
# Run the build_source script.  (This script checks out the latest openwrt trunk source or updates your existing source. Make sure your local copy of the fabfi repository is up to date before running this script. ( svn up ))
{{{
bash build_source
(The script will ask you for your openwrt source directory.  It uses trunk.  so you'll want to give it the path that ends in /trunk.)
}}}

== Method 2: Manual Source Build ==

# Prepare your computer - http://wiki.openwrt.org/doc/howto/buildroot.exigence
#Checkout latest fabfi trunk
{{{
	svn checkout https://fabfi.googlecode.com/svn/trunk/ fabfi 
}}}
# Choose a home for your OpenWRT source and download it.  We choose openwrt.trunk below
{{{
svn checkout svn://svn.openwrt.org/openwrt/trunk/ openwrt.trunk
}}}
# Copy feeds.conf.default from fabfi trunk to openwrt trunk
{{{
cd openwrt.trunk
cp fabfi/openwrt/feeds.conf.default openwrt.trunk/feeds.conf.default
}}}
# Copy config from fabfi trunk to openwrt.trunk ( observe that in fabfi trunk, the filename is config; in openwrt.trunk, the filename is .config )
{{{
	cp fabfi/openwrt/config openwrt.trunk/.config
}}}
# Copy fabfi files from fabfi trunk to openwrt.trunk
{{{
cp -a fabfi/files/fabfi openwrt.trunk/target/linux/ar71xx/base-files/etc/
}}}
# Enter openwrt.trunk, update sources and install.  Then compile.
{{{
cd openwrt.trunk
./scripts/feeds update -a
./scripts/feeds install -a
make defconfig
make V=99
}}}
To compile faster, you might want to run several parallel make processes
{{{
make -j 4 V=99 #for 4 concurrent processes
}}}





=== Building Source ===

If you have not done so before, now is the time to [http://wiki.openwrt.org/doc/howto/build set up your build enviroment] (you can stop at "Downloading Feeds")

{{{
$  cd {your svn dir}/fabfi/
$  svn checkout https://fabfi.googlecode.com/svn/trunk --username yourgoogleusername
}}}

Download the OpenWRT source to a directory of your choice
{{{
$ cd {your backfire source dir}
$ svn co svn://svn.openwrt.org/openwrt/branches/backfire
}}}

Navigate to the scripts directory and run the src builder:
{{{
$ cd {fabfi svn}/trunk/scripts/
$ sudo sh buildsrc.sh
}}}

the above command will probably take an hour or so the first time you run it.  When it finishes, you will find a brand new [http://wiki.openwrt.org/doc/howto/imagebuilder imagebuilder] in the bin directory for your platform.  My imagebuilder comes out here:
{{{
{your backfire source dir}/bin/ar71xx/OpenWrt-ImageBuilder-ar71xx-for-Linux-i686.tar.bz2
}}}

Open this archive and extract the contained folder to your hard drive.  You will use it to complete the rest of the build process

=== Building from Imagbuilder ===

*NOTE: as of this version, you can no longer simply download the stock OpenWRT imagebuilder from OpenWRT and proceed.  You must instead use our custom imagebuilder or download and build awesome-chilli from [http://afrimesh.googlecode.com/svn/branches/unstable/package-scripts/openwrt/ afrimesh] then update the package list (I have no idea how to do the latter part).*

If you're not building from source or hacking stock OpenWRT, [http://portal.joinafrica.org/dev/fabfi-OpenWrt-ImageBuilder-ar71xx-for-Linux-i686.tar.bz2 get our custom imagebuilder here].

Extract the imagebuilder to your directory of choice.

Then, from the scripts directory from above, run:
{{{
$ sh ffimage.sh
}}}

You will be asked to enter the profile name and the path to the imagebuilder.  The currently available profiles are 
  * WRT160NL
  * UBNTNANOM (works for ubiquiti nanom and picoM devices)

Note: "path to the imagebuilder" is the path to the contents of the imagebuilder folder you extracted above.  

If this process completes with no errors (and it should), you will find you image in:
{{{
{path to imagebuilder}/bin/ar71xx/
}}}

The ones you care about are the .bin files ending in "factory" and "sysupgrade" with the device name of the device you built fw for.  
